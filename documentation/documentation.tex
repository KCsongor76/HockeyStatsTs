\documentclass[11pt, a4paper]{report}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\usepackage{titlesec}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{longtable}

\geometry{left=2.5cm, right=2.5cm, top=2.5cm, bottom=2.5cm}
\definecolor{primaryBlue}{RGB}{0, 51, 102}

\title{\textbf{Software Requirements Specification}\\ \large Legacy System: HockeyStatsTS (v1.0)}
\author{Detailed System Audit}
\date{\today}

\begin{document}
	
	\maketitle
	\tableofcontents
	\newpage
	
	\chapter{System Overview}
	\section{Product Scope}
	HockeyStatsTS is a React-based Single Page Application (SPA) designed for post-game statistical logging. It allows administrators to define teams and players, configure game metadata, and log events (goals, shots, penalties) by interacting with a digital rink representation. The system relies on Firebase for backend services and uses a custom Object-Oriented Programming (OOP) layer within the frontend for business logic.
	
	\section{User Roles}
	\begin{itemize}
		\item \textbf{Public User:} Can view the Landing Page (Login).
		\item \textbf{Administrator:} Identified via a hardcoded \texttt{adminUids} array in the source code. Has full access to CRUD operations and Game Logging.
	\end{itemize}
	
	\chapter{Detailed Functional Requirements}
	
	\section{Module 1: Authentication \& Routing}
	\textbf{File Reference:} \texttt{App.tsx}, \texttt{AuthPage.tsx}
	
	\subsection{Authentication Flow}
	\begin{enumerate}
		\item \textbf{Initialization:} On application load, \texttt{App.tsx} triggers a Firebase \texttt{onAuthStateChanged} listener.
		\item \textbf{Verification:}
		\begin{itemize}
			\item If a user object exists, the system checks if \texttt{user.uid} is present in the \texttt{adminUids} array.
			\item State variable \texttt{isSignedIn} is set to \texttt{true} ONLY if the UID matches.
		\end{itemize}
		\item \textbf{Routing Guard:}
		\begin{itemize}
			\item If \texttt{isSignedIn} is false, any attempt to access protected routes (starts with \texttt{/admin}, \texttt{/game}, etc.) triggers a redirect to \texttt{/}.
			\item A \texttt{LoadingSpinner} is displayed while the auth check resolves.
		\end{itemize}
	\end{enumerate}
	
	\subsection{Route Definitions}
	The application uses \texttt{createBrowserRouter} with the following structure:
	\begin{longtable}{|p{4cm}|p{5cm}|p{6cm}|}
		\hline
		\textbf{Path} & \textbf{Component} & \textbf{Functionality} \\
		\hline
		\texttt{/} & \texttt{HomePage} & Dashboard showing menu options based on auth status. \\
		\hline
		\texttt{/start} & \texttt{StartPage} & \textbf{Loader:} Fetches all Teams. Displays Game Setup form. \\
		\hline
		\texttt{/game} & \texttt{GamePage} & The core logging interface. Requires \texttt{location.state} with setup data. \\
		\hline
		\texttt{/saved-games} & \texttt{SavedGamesPage} & Lists historical games from Firestore. \\
		\hline
		\texttt{/handle-teams} & \texttt{TeamCRUDPage} & \textbf{Loader:} Fetches Teams + Games. Lists teams with filters. \\
		\hline
		\texttt{/handle-teams/create} & \texttt{CreateTeamPage} & Form to add new Team entities. \\
		\hline
		\texttt{/handle-players} & \texttt{PlayerCRUDPage} & \textbf{Loader:} Fetches Players + Teams. Lists players. \\
		\hline
	\end{longtable}
	
	\section{Module 2: Master Data Management}
	\textbf{File Reference:} \texttt{TeamCRUDPage.tsx}, \texttt{PlayerCRUDPage.tsx}
	
	\subsection{Team Management}
	\begin{enumerate}
		\item \textbf{Data Loading:} The route loader fetches all teams via \texttt{TeamService.getAllTeams()} and games via \texttt{GameService.getAllGames()} (for dependency checking).
		\item \textbf{Filtering:} Users can filter the list by Name (text input), Season (dropdown), and Championship (dropdown).
		\item \textbf{Deletion Logic:}
		\begin{itemize}
			\item User clicks Delete.
			\item System prompts \texttt{window.confirm}.
			\item Calls \texttt{TeamService.deleteTeam(id)}.
			\item \textbf{Constraint:} Does not check if the team has existing games before deletion (potential for orphaned data).
		\end{itemize}
	\end{enumerate}
	
	\section{Module 3: The Game Logging Engine}
	\textbf{File Reference:} \texttt{GamePage.tsx}
	
	\subsection{State Management}
	The page maintains complex local state:
	\begin{itemize}
		\item \texttt{gameSetup}: Metadata passed from StartPage.
		\item \texttt{actions}: Array of \texttt{IGameAction} representing the event log.
		\item \texttt{homeScore / awayScore}: Computed local state objects.
		\item \texttt{modalStep}: Finite State Machine (\texttt{'action'} $\rightarrow$ \texttt{'player'} $\rightarrow$ \texttt{'assist'} $\rightarrow$ \texttt{'confirm'}).
	\end{itemize}
	
	\subsection{Event Creation Workflow}
	\begin{enumerate}
		\item \textbf{Trigger:} User clicks \texttt{InteractiveRink}.
		\item \textbf{Step 1: Action Selection (Modal A)}
		\begin{itemize}
			\item \textbf{UI:} Displays Time Input (Period, Min, Sec).
			\item \textbf{Grid:} Two distinct rows. Row 1 = Home Team Actions. Row 2 = Away Team Actions.
			\item \textbf{Visuals:} Icons use the respective Team's Primary/Secondary colors passed via props.
			\item \textbf{Selection:} User clicks an Action Type (e.g., GOAL). System stores \texttt{currentAction.type} and \texttt{currentAction.team}.
		\end{itemize}
		\item \textbf{Step 2: Player Selection (Modal B)}
		\begin{itemize}
			\item \textbf{UI:} Lists players from the selected team's roster.
			\item \textbf{Selection:} User selects a player.
			\item \textbf{Branching:} If Action == GOAL, proceed to Step 3. Else, proceed to Step 4.
		\end{itemize}
		\item \textbf{Step 3: Assist Selection (Modal C)}
		\begin{itemize}
			\item \textbf{UI:} Multi-select list of teammates (excluding the scorer).
			\item \textbf{Actions:} User selects 0, 1, or 2 players and clicks "Next".
		\end{itemize}
		\item \textbf{Step 4: Confirmation (Modal D)}
		\begin{itemize}
			\item \textbf{UI:} Displays summary card (Action, Time, Player, Location).
			\item \textbf{Controls:} "Confirm" (Commit), "Edit" (Step Back), "Cancel" (Abort).
		\end{itemize}
		\item \textbf{Commit:}
		\begin{itemize}
			\item New action pushed to \texttt{actions} array.
			\item \texttt{updateScores} function recalculates the scoreboard immediately.
			\item \texttt{autosave} triggers \texttt{localStorage.setItem('unfinishedGame')}.
		\end{itemize}
	\end{enumerate}
	
	\subsection{Autosave \& Persistence}
	\begin{itemize}
		\item The system writes the entire \texttt{gameState} object to \texttt{localStorage} under the key \texttt{'unfinishedGame'} on every action change if autosave is toggled on.
		\item On \texttt{GamePage} mount, it checks for this key and hydrates state if found.
	\end{itemize}
	
\end{document}